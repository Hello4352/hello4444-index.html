<script>
  const TOTAL_SEATS = 28;
  const seatStates = Array(TOTAL_SEATS).fill(null); // X 표시 상태 저장

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function createCell(seatIndex, value) {
    const div = document.createElement("div");
    div.className = "cell";
    div.dataset.seatIndex = seatIndex;

    if (seatStates[seatIndex] === "X") {
      div.textContent = "×";
      div.classList.add("clicked");
    } else {
      div.textContent = value;
    }

    div.addEventListener("click", () => {
      const idx = parseInt(div.dataset.seatIndex);
      if (seatStates[idx] === "X") {
        seatStates[idx] = null;
        div.classList.remove("clicked");
        div.textContent = div.dataset.originalValue || "";
      } else {
        seatStates[idx] = "X";
        div.classList.add("clicked");
        div.dataset.originalValue = div.textContent;
        div.textContent = "×";
      }
    });

    return div;
  }

  function generateSeats() {
    const start = parseInt(document.getElementById("startNum").value);
    const end = parseInt(document.getElementById("endNum").value);
    const excludeRaw = document.getElementById("excludeNums").value;
    const exclude = excludeRaw.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));

    const left = document.getElementById("leftSection");
    const center = document.getElementById("centerSection");
    const right = document.getElementById("rightSection");
    const unplacedBox = document.getElementById("unplaced");

    left.innerHTML = center.innerHTML = right.innerHTML = "";
    unplacedBox.style.display = "none";
    unplacedBox.innerHTML = "";

    if (start >= end || start < 1 || end < 1) {
      alert("시작과 끝 번호를 정확히 입력해주세요.");
      return;
    }

    // 사용할 번호 추출
    const allNumbers = [];
    for (let i = start; i <= end; i++) {
      if (!exclude.includes(i)) {
        allNumbers.push(i);
      }
    }

    shuffle(allNumbers);

    // 사용할 수 있는 좌석 인덱스 추출 (X 표시 제외)
    const availableSeatIndexes = [];
    for (let i = 0; i < TOTAL_SEATS; i++) {
      if (seatStates[i] !== "X") {
        availableSeatIndexes.push(i);
      }
    }

    shuffle(availableSeatIndexes); // 좌석도 섞어서 번호가 퍼지게 함

    const seatValues = Array(TOTAL_SEATS).fill("");
    const count = Math.min(allNumbers.length, availableSeatIndexes.length);
    for (let i = 0; i < count; i++) {
      seatValues[availableSeatIndexes[i]] = allNumbers[i];
    }

    // 남은 번호 표시
    const remaining = allNumbers.slice(count);
    if (remaining.length > 0) {
      unplacedBox.style.display = "block";
      unplacedBox.textContent = "배치되지 못한 번호: " + remaining.join(", ");
    }

    // 좌석 출력
    const sections = [
      { el: left, count: 8 },
      { el: center, count: 10 },
      { el: right, count: 10 }
    ];
    let seatIndex = 0;
    sections.forEach(section => {
      for (let i = 0; i < section.count; i++) {
        section.el.appendChild(createCell(seatIndex, seatValues[seatIndex]));
        seatIndex++;
      }
    });
  }
</script>
